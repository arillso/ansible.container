# K3s Container Registry Configuration
# Generated by arillso.container.k3s role

{% if k3s_private_registries is defined and k3s_private_registries | length > 0 %}
mirrors:
{% for registry in k3s_private_registries %}
  {% if registry.mirrors is defined %}
  "{{ registry.name }}":
    endpoint:
    {% for mirror in registry.mirrors %}
      - "{{ mirror }}"
    {% endfor %}
  {% endif %}
{% endfor %}

configs:
{% for registry in k3s_private_registries %}
  {% if registry.auth is defined or registry.tls is defined %}
  "{{ registry.endpoint | default(registry.name) }}":
    {% if registry.auth is defined %}
    auth:
      {% if registry.auth.username is defined and registry.auth.password is defined %}
      username: "{{ registry.auth.username }}"
      password: "{{ registry.auth.password }}"
      {% elif registry.auth.auth is defined %}
      auth: "{{ registry.auth.auth }}"
      {% elif registry.auth.identity_token is defined %}
      identitytoken: "{{ registry.auth.identity_token }}"
      {% endif %}
    {% endif %}
    {% if registry.tls is defined %}
    tls:
      {% if registry.tls.cert_file is defined %}
      cert_file: "{{ registry.tls.cert_file }}"
      {% endif %}
      {% if registry.tls.key_file is defined %}
      key_file: "{{ registry.tls.key_file }}"
      {% endif %}
      {% if registry.tls.ca_file is defined %}
      ca_file: "{{ registry.tls.ca_file }}"
      {% endif %}
      {% if registry.tls.insecure_skip_verify is defined %}
      insecure_skip_verify: {{ registry.tls.insecure_skip_verify | lower }}
      {% endif %}
    {% endif %}
  {% endif %}
{% endfor %}
{% endif %}
